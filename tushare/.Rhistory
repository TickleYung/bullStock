load("/Users/surgery/Project/HOME/1-projects/0.bulk_RNA-Seq/11-RET_BACE2_paper/ThreeGroup/three.seperate.Rdata")
View(all_DEGs_sort_1000)
all_DEGs_sort_1000$mark
table(all_DEGs_sort_1000$mark)
table(all_DEGs_sort_2000$mark)
View(all_DEGs)
View(common_DEGs)
View(RET_CD)
View(RET_CD_DEGs)
View(TCA_DEGs)
View(RET_NCD_DEGs)
load("/Users/surgery/Project/HOME/1-projects/0.bulk_RNA-Seq/11-RET_BACE2_paper/3_grouups.Rdata")
RET_NCD
dim(RET_NCD)
View(all_DEGs_sort_2000)
all_DEGs_sort_2000$mark
table(all_DEGs_sort_2000$mark)
write.csv(all_DEGs_sort_2000, file = "/Users/surgery/Project/HOME/1-projects/0.bulk_RNA-Seq/11-RET_BACE2_paper/ThreeGroup/2000/all_DEGs_sort_2000.csv")
?kmeans
hist(rnorm(1000,10,3))
hist(rnorm(1000,10,3),breaks = 100)
library(ZIM)
zrind(1000, 10, 1, 0.5)
zrinb(1000, 10, 1, 0.5)
rzinb(1000, 10, 1, 0.5)
hist(rzinb(1000, 10, 1, 0.5))
hist(rzinb(1000, 10, 4, 0.5))
hist(rzinb(1000, 10, 7, 0.5))
hist(rzinb(1000, 10, 10, 0.5))
hist(rzinb(1000, 10, 50, 0.5))
hist(rzinb(1000, 10, 50, 0.5), breaks = 100)
hist(rzinb(1000, 10, 50, 0.5), breaks = 10)
hist(rzinb(1000, 10, 50, 0.5), breaks = 20)
hist(rzinb(1000, 10, 50, 0.5), breaks = 10)
logExpr=10; ngene=20; ncell=10; show_matrix=T; show_name=T
totalGene <- ngene*11
totalCell <- ncell*4
expr_matrix <- matrix(rep(0,totalGene*totalCell), nrow=totalGene, ncol=totalCell)
# MT1
for (i in 1:ngene) {
for (j in 1:ncell) {
expr_matrix[i,j] <- logExpr
}
}
for (i in (ngene*4+1):(ngene*5)) {
for (j in (ncell*3+1):(ncell*4)) {
expr_matrix[i,j] <- logExpr
}
}
for (i in (ngene*4+1):(ngene*5)) {
for (j in 1:ncell) {
expr_matrix[i,j] <- logExpr
}
}
# MT1'
for (i in (ngene+1):(ngene*2)) {
for (j in (ncell+1):totalCell) {
expr_matrix[i,j] <- logExpr
}
}
# MT1''
for (i in (ngene*2+1):(ngene*3)) {
for (j in (ncell+1):(ncell*2)) {
expr_matrix[i,j] <- logExpr/sqrt(i-ngene*2)
}
}
# MT1'''
for (i in (ngene*3+1):(ngene*4)) {
for (j in (ncell*2+1):(ncell*3)) {
expr_matrix[i,j] <- logExpr/sqrt(j-ncell*2)
}
}
# MT2
for (i in (ngene*5+1):(ngene*6)) {
for (j in (ncell*3+1-ncell/2):(ncell*4-ncell/2)) {
expr_matrix[i,j] <- logExpr/sqrt(2*abs(j-((ncell*3+1-ncell/2+ncell*4-ncell/2))/2))
}
}
# MT3
for (i in (ngene*6+1):(ngene*7)) {
for (j in (ncell*0+1):(ncell*1)) {
expr_matrix[i,j] <- logExpr/2
}
}
for (i in (ngene*6+1):(ngene*7)) {
expr_matrix[i,] <- expr_matrix[i,] + logExpr/2
}
# MT4
piece <- logExpr/totalCell
for (i in (ngene*7+1):(ngene*8)) {
for (j in (ncell*0+1):(totalCell)) {
#expr_matrix[i,j] <- logExpr/sqrt(1+abs(j-totalCell))
expr_matrix[i,j] <- piece*j
}
}
# MT4'
for (i in (ngene*8+1):(ngene*9)) {
for (j in (ncell*0+1):(totalCell)) {
# expr_matrix[i,j] <- logExpr/sqrt(j)
expr_matrix[i,j] <- logExpr-piece*j
}
}
# Noise1
for (i in (ngene*9+1):(ngene*10)) {
tmp_mean <- sample(1:logExpr, 1)
tmp_sd <- sample(seq(1,3,by=0.3), 1)
expr_matrix[i,] <- rnorm(totalCell, mean = tmp_mean, sd = tmp_sd)
# hist(rnorm(1000,10,3),breaks = 100)
}
# Noise2
for (i in (ngene*10+1):(ngene*11)) {
library(ZIM)
tmp_k <- sample(1:logExpr, 1)
tmp_lambda <- sample(seq(1,10,by=1), 1)
tmp_omega <- sample(seq(0,1,by=0.1), 1)
expr_matrix[i,] <- rzinb(totalCell, tmp_k, tmp_lambda, tmp_omega)
# hist(rzinb(1000, 10, 50, 0.5))
}
rownames(expr_matrix) <- 1:totalGene
colnames(expr_matrix) <- 1:totalCell
expr_matrix[expr_matrix>10] <- 10
expr_matrix[expr_matrix<0] <- 0
options(stringsAsFactors = F)
expr_matrix <- as.data.frame(expr_matrix)
annotation_col <- data.frame(cluster=colnames(expr_matrix), row.names = colnames(expr_matrix))
annotation_col[(ncell*0+1):(ncell*1),] <- "Subtype1"
annotation_col[(ncell*1+1):(ncell*2),] <- "Subtype2"
annotation_col[(ncell*2+1):(ncell*3),] <- "Subtype3"
annotation_col[(ncell*3+1):(ncell*4),] <- "Subtype4"
annotation_row <- data.frame(markerType=rownames(expr_matrix), row.names = rownames(expr_matrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
library(RColorBrewer)
annotation_colors1 <- brewer.pal(4,"Set1")
names(annotation_colors1) <- c("Subtype1", "Subtype2", "Subtype3", "Subtype4")
annotation_colors2 <- brewer.pal(10,"Set3")
names(annotation_colors2) <- c("MT1", "MT1-neg", "MT1'", "MT1''", "MT2-intermediate", "MT3", "MT4", "MT4'", "Noise1", "Noise2")
if (show_matrix){
library(pheatmap)
pheatmap(expr_matrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_col, annotation_row = annotation_row, annotation_colors=list(cluster=annotation_colors1 , markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
}
expr_matrix2 <- expr_matrix
geneCount <- dim(expr_matrix)[1]
cellCount <- dim(expr_matrix)[2]
for (i in 1:geneCount) {
randomCells <- sample(1:cellCount, as.integer(0.1*cellCount))
expr_matrix[i,randomCells] <- 0
}
pheatmap(expr_matrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_col, annotation_row = annotation_row, annotation_colors=list(cluster=annotation_colors1 , markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
method="pearson"
corMatrix <- cor(x = as.matrix(t(expr_matrix)), method = method)
corMatrix
dim(corMatrix)
dim(expr_matrix)
pheatmap(corMatrix)
corMatrix[is.na(corMatrix)] <- 0
pheatmap(corMatrix)
pheatmap(corMatrix, cluster_cols = F, cluster_rows = F)
method="spearman"
corMatrix <- cor(x = as.matrix(t(expr_matrix)), method = method)
corMatrix[is.na(corMatrix)] <- 0
pheatmap(corMatrix, cluster_cols = F, cluster_rows = F)
annotation_row <- data.frame(markerType=rownames(corMatrix), row.names = rownames(corMatrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
annotation_row
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
method="pearson"
corMatrix <- cor(x = as.matrix(t(expr_matrix)), method = method)
corMatrix[is.na(corMatrix)] <- 0
annotation_row <- data.frame(markerType=rownames(corMatrix), row.names = rownames(corMatrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
corMatrix <- cor(x = as.matrix(t(expr_matrix2)), method = method)
corMatrix[is.na(corMatrix)] <- 0
annotation_row <- data.frame(markerType=rownames(corMatrix), row.names = rownames(corMatrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
?pheatmap
corMatrix <- cor(x = as.matrix(t(expr_matrix2)), method = method)
corMatrix[is.na(corMatrix)] <- 0
annotation_row <- data.frame(markerType=rownames(corMatrix), row.names = rownames(corMatrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F)
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color = colorRampPalette(c("dark blue", "blue", "white", "orange", "red")))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color = colorRampPalette(c("dark blue", "blue", "white", "orange", "red"))(100))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color = colorRampPalette(c(""blue", "white","red"))(100))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color = colorRampPalette(c("blue", "white","red"))(100))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, colorRampPalette(rev(brewer.pal(n = 7, name ="RdYlBu")))(100))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color=colorRampPalette(rev(brewer.pal(n = 7, name ="RdYlBu")))(100))
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color=colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100))
corMatrix <- cor(x = as.matrix(t(expr_matrix)), method = method)
corMatrix[is.na(corMatrix)] <- 0
annotation_row <- data.frame(markerType=rownames(corMatrix), row.names = rownames(corMatrix))
annotation_row[(ngene*0+1):(ngene*1),] <- "MT1"
annotation_row[(ngene*1+1):(ngene*2),] <- "MT1-neg"
annotation_row[(ngene*2+1):(ngene*3),] <- "MT1'"
annotation_row[(ngene*3+1):(ngene*4),] <- "MT1''"
annotation_row[(ngene*4+1):(ngene*5),] <- "MT1"
annotation_row[(ngene*5+1):(ngene*6),] <- "MT2-intermediate"
annotation_row[(ngene*6+1):(ngene*7),] <- "MT3"
annotation_row[(ngene*7+1):(ngene*8),] <- "MT4"
annotation_row[(ngene*8+1):(ngene*9),] <- "MT4'"
annotation_row[(ngene*9+1):(ngene*10),] <- "Noise1"
annotation_row[(ngene*10+1):(ngene*11),] <- "Noise2"
pheatmap(corMatrix, cluster_rows = F, cluster_cols = F, show_rownames = F, show_colnames = F, annotation_col = annotation_row, annotation_row = annotation_row, annotation_colors=list(markerType=annotation_colors2), annotation_names_row=F, annotation_names_col = F, color=colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100))
load("/Users/surgery/Downloads/Supplementary_Software/R/data/Test_3_Pollen.RData")
dim(Test_3_Pollen$in_X)
deng <- readRDS("/Users/surgery/Project/HOME/github/scRNA.seq.course/deng/deng-reads.rds")
dim(deng)
springCoord <- read.csv("/Users/surgery/Project/HOME/github/SPRING/datasets/SAG_python/coordinates.txt", header = F, row.names = 1)
plot(springCoord$V2, springCoord$V3)
plot(springCoord$V2, -springCoord$V3)
colanno <- read.csv("/Users/surgery/Project/HOME/1-projects/1.scRNA-seq/1-batch/1-formal/SAG/Output/all_SAG_colanno.csv", header = T)
colanno
colanno <- read.csv("/Users/surgery/Project/HOME/1-projects/1.scRNA-seq/1-batch/1-formal/SAG/Output/all_SAG_colanno.csv", header = T, row.names = 1)
colanno
springCoord <- read.csv("/Users/surgery/Project/HOME/github/SPRING/datasets/SAG_python/coordinates.txt", header = F, row.names = 1)
colanno <- read.csv("/Users/surgery/Project/HOME/1-projects/1.scRNA-seq/1-batch/1-formal/SAG/Output/all_SAG_colanno.csv", header = T, row.names = 1)
plot(springCoord$V2, -springCoord$V3)
?prcomp
setwd("/Users/surgery/Project/HOME/github/bullStock/tushare")
all_basics <- read.csv("stock_basics.csv", header = T)
all_basics
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T)
?read.csv
all_basics$name
options(stringsAsFactors = T)
all_basics <- read.csv("stock_basics.csv", header = T)
all_basics$name
options(stringsAsFactors = F)
all_basics <- read.csv("stock_basics.csv", header = T)
all_basics$name
all_basics <- read.csv("stock_basics.csv", header = T, quote = "")
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T, dec = "")
all_basics <- read.csv("stock_basics.csv", header = T, dec = ",")
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T, numerals = "")
all_basics <- read.csv("stock_basics.csv", header = T, numerals = "no.loss")
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T, as.is = F)
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T, as.is = T)
all_basics$code
all_basics <- read.csv("stock_basics.csv", header = T, colClasses = "character")
all_basics$code
all_basics$code
all_basics$name
all_basics$industry
all_basics$pe
as.numeric(all_basics$pe)
rownames(all_basics) <- all_basics$code
all_basics
all_basics[,"timeToMarket"]
as.numeric(all_basics[,"timeToMarket"])
all_basics[,"timeToMarket"] <- as.numeric(all_basics[,"timeToMarket"])
issueYear <- as.integer(all_basics[,"timeToMarket"]/10000)
issueYear
hist(issueYear)
hist(issueYear, breaks = 100)
barplot(table(issueYear)[names(table(issueYear))!=0])
table(issueYear)[names(table(issueYear))!=0]
all_basics[,"timeToMarket"]
table(issueYear)
all_basics[,"timeToMarket"][issueYear==0]
all_basics[,issueYear==0]
all_basics[issueYear==0,]
all_basics[,"timeToMarket"]
all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820
all_basics[all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820,]
all_basics[all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820,]$code
dim(all_basics[all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820,])
table(issueYear)[names(table(issueYear))!=0]
filterCode <- all_basics[all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820,]
filterCode
all_basics[!(all_basics[,"timeToMarket"] > 0 & all_basics[,"timeToMarket"] < 20160820),]
filterCode$timeToMarket
filterCode$timeToMarket/10000
as.integer(filterCode$timeToMarket/10000)
table(as.integer(filterCode$timeToMarket/10000))
write.csv(filterCode, file="filterCode.csv")
filterCode["002913",]
filterCode
filterCode$max2year <- "miss"
filterCode$max1year <- "miss"
filterCode$max6month <- "miss"
filterCode$min2year <- "miss"
filterCode$min1year <- "miss"
filterCode$min6month <- "miss"
filterCode$code
filterCode$code
i <- "600379"
tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
tmpdf
dim(tmpdf)
dim(tmpdf)[1]
tmpdf$date
gsub("-", "", tmpdf$date)
as.integer(gsub("-", "", tmpdf$date))
tmpdf$data <- as.integer(gsub("-", "", tmpdf$date))
tmpdf
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
tmpdf
filterCode[i,]$max2year
tmpdf[tmpdf$date2>20170820,]
tmpdf[tmpdf$date2>20170820,]$close
max(tmpdf[tmpdf$date2>20170820,]$close)
max(tmpdf[tmpdf$date2>20160820,]$close)
max(tmpdf[tmpdf$date2>20170820,]$close)
max(tmpdf[tmpdf$date2>20180220,]$close)
min(tmpdf[tmpdf$date2>20160820,]$close)
min(tmpdf[tmpdf$date2>20170820,]$close)
min(tmpdf[tmpdf$date2>20180220,]$close)
tmpdf[tmpdf$date2>20160820,]$close
tmpdf[tmpdf$date2>20160820,]
tail(tmpdf[tmpdf$date2>20160820,])
tmpdf[tmpdf$date2>20170820,]
tmpdf[tmpdf$date2>20180220,]
filterCode$20180820 <- "miss"
filterCode$close20180820 <- "miss"
tail(tmpdf[tmpdf$date2>20160820,])
tail(tmpdf)
tail(tmpdf, n = 1)
tail(tmpdf, n = 1)$close
filterCode$close20180820 <- NULL
filterCode
filterCode$tmpclose <- "miss"
tail(tmpdf, n = 1)$close
for (i in filterCode$code) {
tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
if (dim(tmpdf)[1] < 200) {next}
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
filterCode[i,]$tmpclose <- tail(tmpdf, n = 1)$close
filterCode[i,]$max2year <- max(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$max1year <- max(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$max6month <- max(tmpdf[tmpdf$date2>20180220,]$close)
filterCode[i,]$min2year <- min(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$min1year <- min(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$min6month <- min(tmpdf[tmpdf$date2>20180220,]$close)
}
filterCode$code
paste("price/",i,".csv",sep="")
dim(tmpdf)[1]
dim(tmpdf)[1] < 200
filterCode
for (i in filterCode$code) {
print(i)
tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
if (dim(tmpdf)[1] < 200) {next}
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
filterCode[i,]$tmpclose <- tail(tmpdf, n = 1)$close
filterCode[i,]$max2year <- max(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$max1year <- max(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$max6month <- max(tmpdf[tmpdf$date2>20180220,]$close)
filterCode[i,]$min2year <- min(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$min1year <- min(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$min6month <- min(tmpdf[tmpdf$date2>20180220,]$close)
}
i <- "600145"
tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
tmpdf <- try(read.csv(paste("price/",i,".csv",sep="")), silent=TRUE)
tmpdf
dim(tmpdf)[1] < 200
dim(tmpdf)[1]
dim(tmpdf)[1] < 200 | is.null(tmpdf
)
class(result) == "try-error"
class(tmpdf) == "try-error"
for (i in filterCode$code) {
print(i)
#tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
tmpdf <- try(read.csv(paste("price/",i,".csv",sep="")), silent=TRUE)
if (class(tmpdf) == "try-error") {next}
if (dim(tmpdf)[1] < 200)) {next}
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
filterCode[i,]$tmpclose <- tail(tmpdf, n = 1)$close
filterCode[i,]$max2year <- max(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$max1year <- max(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$max6month <- max(tmpdf[tmpdf$date2>20180220,]$close)
filterCode[i,]$min2year <- min(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$min1year <- min(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$min6month <- min(tmpdf[tmpdf$date2>20180220,]$close)
}
for (i in filterCode$code) {
print(i)
#tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
tmpdf <- try(read.csv(paste("price/",i,".csv",sep="")), silent=TRUE)
if (class(tmpdf) == "try-error") {next}
if (dim(tmpdf)[1] < 200) {next}
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
filterCode[i,]$tmpclose <- tail(tmpdf, n = 1)$close
filterCode[i,]$max2year <- max(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$max1year <- max(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$max6month <- max(tmpdf[tmpdf$date2>20180220,]$close)
filterCode[i,]$min2year <- min(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$min1year <- min(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$min6month <- min(tmpdf[tmpdf$date2>20180220,]$close)
}
warnings()
filterCode
(filterCode$tmpclose - filterCode$min2year)/(filterCode$max2year - filterCode$min2year)
filterCode$max2year
filterCode$min6month
tmpdf$close
tmpdf$close/2
filterCode$tmpclose
filterCode$max2year
filterCode[filterCode$tmpclose != "miss" & filterCode$max2year != "miss" & filterCode$max1year != "miss" & filterCode$max6month != "miss" & filterCode$min2year != "miss" &filterCode$min1year != "miss" &filterCode$min6month != "miss",]
filterCode <- filterCode[filterCode$tmpclose != "miss" & filterCode$max2year != "miss" & filterCode$max1year != "miss" & filterCode$max6month != "miss" & filterCode$min2year != "miss" &filterCode$min1year != "miss" &filterCode$min6month != "miss",]
filterCode
filterCode$tmpclose
as.numeric(filterCode$tmpclose)
filterCode$tmpclose <- -1
filterCode$max2year <- -1
filterCode$max1year <- -1
filterCode$max6month <- -1
filterCode$min2year <- -1
filterCode$min1year <- -1
filterCode$min6month <- -1
for (i in filterCode$code) {
print(i)
#tmpdf <- read.csv(paste("price/",i,".csv",sep=""))
tmpdf <- try(read.csv(paste("price/",i,".csv",sep="")), silent=TRUE)
if (class(tmpdf) == "try-error") {next}
if (dim(tmpdf)[1] < 200) {next}
tmpdf$date2 <- as.integer(gsub("-", "", tmpdf$date))
filterCode[i,]$tmpclose <- tail(tmpdf, n = 1)$close
filterCode[i,]$max2year <- max(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$max1year <- max(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$max6month <- max(tmpdf[tmpdf$date2>20180220,]$close)
filterCode[i,]$min2year <- min(tmpdf[tmpdf$date2>20160820,]$close)
filterCode[i,]$min1year <- min(tmpdf[tmpdf$date2>20170820,]$close)
filterCode[i,]$min6month <- min(tmpdf[tmpdf$date2>20180220,]$close)
}
filterCode <- filterCode[filterCode$tmpclose != -1 & filterCode$max2year != -1 & filterCode$max1year != -1 & filterCode$max6month != -1 & filterCode$min2year != -1 &filterCode$min1year != -1 &filterCode$min6month != -1,]
filterCode$tmpclose
(filterCode$tmpclose - filterCode$min2year)/(filterCode$max2year - filterCode$min2year)
(filterCode$tmpclose - filterCode$min1year)/(filterCode$max1year - filterCode$min1year)
(filterCode$tmpclose - filterCode$min6month)/(filterCode$max6month - filterCode$min6month)
filterCode$pos2year <- (filterCode$tmpclose - filterCode$min2year)/(filterCode$max2year - filterCode$min2year)
filterCode$pos1year <- (filterCode$tmpclose - filterCode$min1year)/(filterCode$max1year - filterCode$min1year)
filterCode$pos6month <- (filterCode$tmpclose - filterCode$min6month)/(filterCode$max6month - filterCode$min6month)
View(filterCode)
filterCode$totals
filterCode$outstanding
filterCode$outstanding <- as.numeric(filterCode$outstanding)
filterCode$totalvalue
filterCode$outstanding * filterCode$tmpclose
filterCode$totalvalue <- filterCode$totals * filterCode$tmpclose
filterCode$subvalue <- filterCode$outstanding * filterCode$tmpclose
filterCode$totals <- as.numeric(filterCode$totals)
filterCode$outstanding <- as.numeric(filterCode$outstanding)
filterCode$totalvalue <- filterCode$totals * filterCode$tmpclose
filterCode$subvalue <- filterCode$outstanding * filterCode$tmpclose
filterCode
hist(filterCode$totalvalue)
hist(filterCode$pos6month)
hist(filterCode$pos1year)
hist(filterCode$pos2year)
write.csv(filterCode, file="filterCode.csv")
?write.csv
write.csv(filterCode, file="filterCode.csv", fileEncoding = "utf-8")
